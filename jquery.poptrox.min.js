!function(a){a.fn.poptrox_disableSelection=function(){return a(this).css("user-select","none").css("-khtml-user-select","none").css("-moz-user-select","none").css("-o-user-select","none").css("-webkit-user-select","none")},a.fn.poptrox=function(b){function n(){i=a(window).width(),j=a(window).height()+d.windowHeightPad;var b=Math.abs(p.width()-p.outerWidth()),c=Math.abs(p.height()-p.outerHeight());r.width(),r.height();var g=i-2*d.windowMargin-b,h=j-2*d.windowMargin-c;p.css("min-width",d.popupWidth).css("min-height",d.popupHeight),q.children().css("max-width",g).css("max-height",h)}function o(){return a(d.selector,e).not("[data-poptrox^='ignore']")}if(0==this.length)return a(this);if(this.length>1){for(var c=0;c<this.length;c++)a(this[c]).poptrox(b);return a(this)}var i,j,d=a.extend({preload:!1,baseZIndex:1e3,fadeSpeed:300,overlayColor:"#000000",overlayOpacity:.6,overlayClass:"poptrox-overlay",windowMargin:50,windowHeightPad:0,selector:"a",caption:null,parent:"body",popupSpeed:300,popupWidth:200,popupHeight:100,popupIsFixed:!1,useBodyOverflow:!1,usePopupEasyClose:!0,usePopupForceClose:!1,usePopupLoader:!0,usePopupCloser:!0,usePopupCaption:!1,usePopupNav:!1,usePopupDefaultStyling:!0,popupBackgroundColor:"#FFFFFF",popupTextColor:"#000000",popupLoaderTextSize:"2em",popupCloserBackgroundColor:"#000000",popupCloserTextColor:"#FFFFFF",popupCloserTextSize:"20px",popupPadding:10,popupCaptionHeight:60,popupCaptionTextSize:null,popupBlankCaptionText:"(untitled)",popupCloserText:"&#215;",popupLoaderText:"&bull;&bull;&bull;&bull;",popupClass:"poptrox-popup",popupSelector:null,popupLoaderSelector:".loader",popupCloserSelector:".closer",popupCaptionSelector:".caption",popupNavPreviousSelector:".nav-previous",popupNavNextSelector:".nav-next",onPopupClose:null,onPopupOpen:null},b),e=a(this),f=a("body"),g=a('<div class="'+d.overlayClass+'"></div>'),h=a(window),k=0,l=!1,m=new Array;d.usePopupLoader||(d.popupLoaderSelector=null),d.usePopupCloser||(d.popupCloserSelector=null),d.usePopupCaption||(d.popupCaptionSelector=null),d.usePopupNav||(d.popupNavPreviousSelector=null,d.popupNavNextSelector=null);var p;p=d.popupSelector?a(d.popupSelector):a('<div class="'+d.popupClass+'">'+(d.popupLoaderSelector?'<div class="loader">'+d.popupLoaderText+"</div>":"")+'<div class="pic"></div>'+(d.popupCaptionSelector?'<div class="caption"></div>':"")+(d.popupCloserSelector?'<span class="closer">'+d.popupCloserText+"</span>":"")+(d.popupNavPreviousSelector?'<div class="nav-previous"></div>':"")+(d.popupNavNextSelector?'<div class="nav-next"></div>':"")+"</div>");var q=p.find(".pic"),r=a(),s=p.find(d.popupLoaderSelector),t=p.find(d.popupCaptionSelector),u=p.find(d.popupCloserSelector),v=p.find(d.popupNavNextSelector),w=p.find(d.popupNavPreviousSelector),x=v.add(w);if(d.usePopupDefaultStyling&&(p.css("background",d.popupBackgroundColor).css("color",d.popupTextColor).css("padding",d.popupPadding+"px"),t.length>0&&(p.css("padding-bottom",d.popupCaptionHeight+"px"),t.css("position","absolute").css("left","0").css("bottom","0").css("width","100%").css("text-align","center").css("height",d.popupCaptionHeight+"px").css("line-height",d.popupCaptionHeight+"px"),d.popupCaptionTextSize&&t.css("font-size",popupCaptionTextSize)),u.length>0&&u.html(d.popupCloserText).css("font-size",d.popupCloserTextSize).css("background",d.popupCloserBackgroundColor).css("color",d.popupCloserTextColor).css("display","block").css("width","40px").css("height","40px").css("line-height","40px").css("text-align","center").css("position","absolute").css("text-decoration","none").css("outline","0").css("top","0").css("right","-40px"),s.length>0&&s.html("").css("position","relative").css("font-size",d.popupLoaderTextSize).on("startSpinning",function(){var c=a("<div>"+d.popupLoaderText+"</div>");c.css("height",Math.floor(d.popupHeight/2)+"px").css("overflow","hidden").css("line-height",Math.floor(d.popupHeight/2)+"px").css("text-align","center").css("margin-top",Math.floor((p.height()-c.height()+(t.length>0?t.height():0))/2)).css("color",d.popupTextColor?d.popupTextColor:"").on("xfin",function(){c.fadeTo(300,.5,function(){c.trigger("xfout")})}).on("xfout",function(){c.fadeTo(300,.05,function(){c.trigger("xfin")})}).trigger("xfin"),s.append(c)}).on("stopSpinning",function(){var b=s.find("div");b.remove()}),2==x.length)){x.css("font-size","75px").css("text-align","center").css("color","#fff").css("text-shadow","none").css("height","100%").css("position","absolute").css("top","0").css("opacity","0.35").css("cursor","pointer").css("box-shadow","inset 0px 0px 10px 0px rgba(0,0,0,0)").poptrox_disableSelection();var y,z;d.usePopupEasyClose?(y="100px",z="100px"):(y="75%",z="25%"),v.css("right","0").css("width",y).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; right: 0; margin-top: -50px;">&gt;</div>'),w.css("left","0").css("width",z).html('<div style="position: absolute; height: 100px; width: 125px; top: 50%; left: 0; margin-top: -50px;">&lt;</div>')}h.on("resize orientationchange",function(){n()}),t.on("update",function(a,b,c){b&&0!=b.length||(b=d.popupBlankCaptionText),t.html(b),p.trigger("poptrox_caption_init",[b,c])}).click(function(){return!1}),u.css("cursor","pointer").on("click",function(a){return a.preventDefault(),a.stopPropagation(),p.trigger("poptrox_close"),!0}),v.on("click",function(){p.trigger("poptrox_next")}),w.on("click",function(){p.trigger("poptrox_previous")}),g.css("position","fixed").css("left",0).css("top",0).css("z-index",d.baseZIndex).css("width","100%").css("height","100%").css("text-align","center").css("cursor","pointer").appendTo(d.parent).prepend('<div style="display:inline-block;height:100%;vertical-align:middle;"></div>').append('<div style="position:absolute;left:0;top:0;width:100%;height:100%;background:'+d.overlayColor+";opacity:"+d.overlayOpacity+";filter:alpha(opacity="+100*d.overlayOpacity+');"></div>').hide().on("touchmove",function(){return!1}).on("click",function(a){a.preventDefault(),a.stopPropagation(),p.trigger("poptrox_close")}),d.usePopupEasyClose&&q.css("cursor","pointer").on("click",function(a){a.preventDefault(),a.stopPropagation(),p.trigger("poptrox_close")}),p.css("display","inline-block").css("vertical-align","middle").css("position","relative").css("z-index",1).appendTo(g).hide().on("poptrox_next",function(a){var b=o(),c=k+1;return c>=b.length&&(c=0),A(b[c],a)}).on("poptrox_previous",function(a){var b=o(),c=k-1;return 0>c&&(c=b.length-1),A(b[c],a)}).on("poptrox_reset",function(){n(),p.data("width",d.popupWidth).data("height",d.popupHeight),s.hide().trigger("stopSpinning"),t.hide(),u.hide(),x.hide(),q.hide(),r.detach()}).on("poptrox_open",function(a,b){return l?!0:(l=!0,d.useBodyOverflow&&f.css("overflow","hidden"),d.onPopupOpen&&d.onPopupOpen(),g.fadeTo(d.fadeSpeed,1,function(){p.trigger("poptrox_switch",[b,!0])}),void 0)}).on("poptrox_switch",function(b,c,e){var f;return!e&&l?!0:(l=!0,p.css("width",p.data("width")).css("height",p.data("height")),t.hide(),r.attr("src")&&r.attr("src",""),r.detach(),f=c,r=f.object,r.off("load"),q.css("text-indent","-9999px").show().append(r),"ajax"==f.type?a.get(f.src,function(a){r.html(a),r.trigger("load")}):r.attr("src",f.src),"image"!=f.type&&r.css("position","relative").css("outline","0").css("z-index",d.baseZIndex+100).width(f.width).height(f.height),s.trigger("startSpinning").fadeIn(300),p.show(),d.popupIsFixed?(p.width(d.popupWidth).height(d.popupHeight),r.load(function(){r.off("load"),s.hide().trigger("stopSpinning"),t.trigger("update",[f.captionText,c]).fadeIn(d.fadeSpeed),u.fadeIn(d.fadeSpeed),q.css("text-indent",0).hide().fadeIn(d.fadeSpeed,function(){l=!1}),k=f.index,x.fadeIn(d.fadeSpeed)})):r.load(function(){n(),r.off("load"),s.hide().trigger("stopSpinning");var a=r.width(),b=r.height(),e=function(){t.trigger("update",[f.captionText,c]).fadeIn(d.fadeSpeed),u.fadeIn(d.fadeSpeed),q.css("text-indent",0).hide().fadeIn(d.fadeSpeed,function(){l=!1}),k=f.index,x.fadeIn(d.fadeSpeed),p.data("width",a).data("height",b).css("width","auto").css("height","auto")};a==p.data("width")&&b==p.data("height")?e():p.animate({width:a,height:b},d.popupSpeed,"swing",e)}),"image"!=f.type&&r.trigger("load"),void 0)}).on("poptrox_close",function(){return l&&!d.usePopupForceClose?!0:(l=!0,p.hide().trigger("poptrox_reset"),d.onPopupClose&&d.onPopupClose(),g.fadeOut(d.fadeSpeed,function(){d.useBodyOverflow&&f.css("overflow","auto"),l=!1}),void 0)}).trigger("poptrox_reset"),f.keydown(function(a){if(p.is(":visible"))switch(a.keyCode){case 37:case 32:if(d.usePopupNav)return p.trigger("poptrox_previous"),!1;break;case 39:if(d.usePopupNav)return p.trigger("poptrox_next"),!1;break;case 27:return p.trigger("poptrox_close"),!1}});var A=function(b,c){b=a(b);var h,i,j,e=o().index(b),f=b.find("img"),g=b.data("poptrox");if(b.attr("href")){if(h={index:e,link:b,src:b.attr("href"),captionText:f.attr("title"),width:b.attr("width"),height:b.attr("height"),type:null,object:null},d.caption){if("function"==typeof d.caption)j=d.caption(b);else if("selector"in d.caption){var k=b.find(d.caption.selector);"attribute"in d.caption?j=k.attr(d.caption.attribute):(j=k.html(),d.caption.remove===!0&&k.remove())}}else j=f.attr("title");if(h.captionText=j,g){var l,m=g.split(",");for(l in m)i=m[l].match(/([0-9]+)x([0-9]+)/),i&&3==i.length?(h.width=i[1],h.height=i[2]):h.type=m[l]}if(!h.type)switch(i=h.src.match(/http[s]?:\/\/([a-z0-9\.]+)\/.*/),(!i||i.length<2)&&(i=[!1]),i[1]){case"api.soundcloud.com":h.type="soundcloud";break;case"youtu.be":h.type="youtube",h.width=800,h.height=480;break;case"vimeo.com":h.type="vimeo",h.width=800,h.height=480;break;case"wistia.net":h.type="wistia",h.width=800,h.height=480;break;case"bcove.me":h.type="bcove",h.width=640,h.height=360;break;default:h.type="image"}switch(i=h.src.match(/http([s]?):\/\/[a-z0-9\.]+\/(.*)/),i&&(h.prefix="http"+("s"==i[1]?"s":"")),h.type){case"ignore":break;case"iframe":h.object=a('<iframe src="" frameborder="0"></iframe>'),h.object.on("click",function(a){a.stopPropagation()}).css("cursor","auto");break;case"ajax":h.object=a('<div class="poptrox-ajax"></div>'),h.object.on("click",function(a){a.stopPropagation()}).css("cursor","auto").css("overflow","auto");break;case"soundcloud":h.object=a('<iframe scrolling="no" frameborder="no" src=""></iframe>'),h.src=h.prefix+"://w.soundcloud.com/player/?url="+escape(h.src),h.width="600",h.height="166";break;case"youtube":h.object=a('<iframe src="" frameborder="0" allowfullscreen="1"></iframe>'),h.src=h.prefix+"://www.youtube.com/embed/"+i[2];break;case"vimeo":h.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),h.src=h.prefix+"://player.vimeo.com/video/"+i[2];break;case"wistia":h.object=a('<iframe src="" frameborder="0" allowFullScreen="1"></iframe>'),h.src=h.prefix+"://fast.wistia.net/"+i[2];break;case"bcove":h.object=a('<iframe src="" frameborder="0" allowFullScreen="1" width="100%"></iframe>'),h.src=h.prefix+"://bcove.me/"+i[2];break;default:h.object=a('<img src="" alt="" style="vertical-align:bottom" />')}"ignore"!=h.type&&(b.css("outline",0),c.preventDefault(),c.stopPropagation(),p.trigger("poptrox_open",[h]))}},B=function(){d.preload&&a(d.selector,e).not("[data-poptrox]").each(function(){var b=a(this).attr("href");tmp=document.createElement("img"),tmp.src=b,m.push(tmp)})};return e.delegate(d.selector,"click",function(a){A(this,a)}),B(),a(this)}}(jQuery);